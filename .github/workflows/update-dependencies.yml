---
name: Update Dependencies

on:
  schedule:
    - cron: '0 9 * * 1' # Weekly on Mondays at 9am UTC
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update-go-dependencies:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository.
        uses: actions/checkout@v4

      - name: Set up Go.
        uses: actions/setup-go@v5
        with:
          go-version: '1.20'
          cache: true

      - name: Update Go dependencies.
        run: |
          go get -u ./...
          go mod tidy

      - name: Check for changes.
        id: check-changes
        run: |
          if git diff --quiet go.mod go.sum; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Create Pull Request.
        if: steps.check-changes.outputs.changed == 'true'
        uses: peter-evans/create-pull-request@5e914681df9dc83aa4e4905692ca88beb2f9e91f # v7.0.5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore(deps): update Go dependencies'
          title: 'chore(deps): update Go dependencies'
          body: |
            ## Automated Dependency Update

            This PR updates Go dependencies to their latest versions.

            ### Changes
            - Updated all Go dependencies using `go get -u ./...`
            - Ran `go mod tidy` to clean up module files

            ### Testing
            Please review the changes and ensure all tests pass before merging.

            ---
            *This PR was automatically generated by the update-dependencies workflow.*
          branch: chore/update-go-dependencies
          delete-branch: true
          assignees: SimplicityGuy
          labels: dependencies,automated

      - name: Send notification to Discord.
        uses: sarisia/actions-status-discord@b8381b25576cb341b2af39926ab42c5056cc44ed # v1.15.5
        if: always()
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
